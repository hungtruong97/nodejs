var forIn = require('./for-in');
var vdomUtils = require('./vdom-utils');

var EVENT_NAMES = require('./event-names');
var VOID_ELEMENTS = require('./void-elements');

module.exports = function renderToDom(vdom) {
  if (typeof vdom === 'string') {
    return document.createTextNode(vdom);
  }
  var tagName = vdomUtils.getTagName(vdom);
  var node = document.createElement(tagName);
  var attributes = vdomUtils.getAttributes(vdom);
  if (attributes) {
    forIn(attributes, function(attributeValue, attributeName) {
      if (attributeName === 'style') {
        var cssText = '';
        forIn(attributeValue, function(styleValue, styleProperty) {
          cssText += styleProperty + ':' + styleValue + ';';
        });
        node.style.cssText = cssText;
      } else {
        var eventName = EVENT_NAMES[attributeName];
        if (eventName) {
          node.addEventListener(eventName, attributeValue);
        } else {
          node.setAttribute(attributeName, [].concat(attributeValue).join(' '));
        }
      }
    });
  }
  if (VOID_ELEMENTS[tagName]) {
    return node;
  }
  var children = vdomUtils.getChildren(vdom);
  if (children) {
    children = [].concat(children);
    var i = -1;
    var length = children.length;
    while (++i < length) {
      node.appendChild(renderToDom(children[i]));
    }
  }
  return node;
};
