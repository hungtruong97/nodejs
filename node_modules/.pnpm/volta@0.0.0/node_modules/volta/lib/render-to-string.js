var forIn = require('./for-in');
var vdomUtils = require('./vdom-utils');

var EVENT_NAMES = require('./event-names');
var VOID_ELEMENTS = require('./void-elements');

module.exports = function renderToString(vdom) {
  if (typeof vdom === 'string') {
    return vdom;
  }
  var tagName = vdomUtils.getTagName(vdom);
  var string = '<' + tagName;
  var attributes = vdomUtils.getAttributes(vdom);
  if (attributes) {
    forIn(attributes, function(attributeValue, attributeName) {
      if (!EVENT_NAMES[attributeName]) {
        string += ' ' + attributeName + '="';
        if (attributeName === 'style') {
          forIn(attributeValue, function(styleValue, styleProperty) {
            string += styleProperty + ':' + styleValue + ';';
          });
        } else {
          string += [].concat(attributeValue).join(' ');
        }
        string += '"';
      }
    });
  }
  string += '>';
  if (VOID_ELEMENTS[tagName]) {
    return string;
  }
  var children = vdomUtils.getChildren(vdom);
  if (children) {
    children = [].concat(children);
    var i = -1;
    var length = children.length;
    while (++i < length) {
      string += renderToString(children[i]);
    }
    string += '</' + tagName + '>';
  }
  return string;
};
